<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KH Explore - æ°›åœéæ¿¾</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .active-main-btn { background-color: #3b82f6 !important; color: white !important; transform: scale(0.95); }
        .active-sub-btn { background-color: #1e293b !important; color: white !important; border-color: #1e293b !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-10">

    <!-- é ‚éƒ¨å°èˆª -->
    <header class="bg-white/90 backdrop-blur-md sticky top-0 z-40 border-b border-slate-100 px-6 py-4">
        <div class="flex justify-between items-center max-w-md mx-auto">
            <div>
                <h1 class="text-xl font-black text-slate-800 tracking-tight">KH EXPLORE</h1>
                <p class="text-[9px] text-blue-500 font-bold uppercase tracking-widest">Shared Moments</p>
            </div>
            <button onclick="fetchData()" class="p-2 bg-slate-100 rounded-full active:rotate-180 transition-all duration-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </button>
        </div>
    </header>

    <main class="max-w-md mx-auto p-5 space-y-6">
        
        <!-- ä¸»åˆ†é¡æŒ‰éˆ• -->
        <section class="grid grid-cols-4 gap-3">
            <button id="btn-å…¨éƒ¨" onclick="setMainFilter('å…¨éƒ¨')" class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 bg-white shadow-sm rounded-2xl flex items-center justify-center text-xl border border-slate-100 transition-all">ğŸ </div>
                <span class="text-[10px] font-bold text-slate-400">å…¨éƒ¨</span>
            </button>
            <button id="btn-åœ°é»" onclick="setMainFilter('åœ°é»')" class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 bg-white shadow-sm rounded-2xl flex items-center justify-center text-xl border border-slate-100 transition-all">ğŸ“</div>
                <span class="text-[10px] font-bold text-slate-400">åœ°é»</span>
            </button>
            <button id="btn-é©šå–œ" onclick="setMainFilter('é©šå–œ')" class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 bg-white shadow-sm rounded-2xl flex items-center justify-center text-xl border border-slate-100 transition-all">ğŸ</div>
                <span class="text-[10px] font-bold text-slate-400">é©šå–œ</span>
            </button>
            <button onclick="window.open('æ‚¨çš„Googleè¡¨å–®é€£çµ')" class="flex flex-col items-center gap-2">
                <div class="w-14 h-14 bg-emerald-500 shadow-lg shadow-emerald-100 rounded-2xl flex items-center justify-center text-xl text-white">â•</div>
                <span class="text-[10px] font-bold text-slate-400">æ–°å¢</span>
            </button>
        </section>

        <!-- å­é¸å–®ï¼šæ°›åœèˆ‡ç´°é … -->
        <section id="subMenu" class="hidden animate-fade">
            <p class="text-[10px] font-black text-slate-400 mb-3 ml-1 uppercase tracking-widest">é¸æ“‡æ°›åœé¢¨æ ¼</p>
            <div id="subMenuList" class="flex gap-2 overflow-x-auto hide-scrollbar pb-1">
                <!-- å‹•æ…‹æ³¨å…¥ -->
            </div>
        </section>

        <!-- å…§å®¹åˆ—è¡¨ -->
        <section class="space-y-4">
            <div class="flex items-center justify-between px-1">
                <h2 id="listLabel" class="text-sm font-bold text-slate-500 uppercase tracking-tighter">æœ€è¿‘æ›´æ–°</h2>
                <span id="counter" class="text-[9px] bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full font-black">0 ITEMS</span>
            </div>
            
            <div id="dataList" class="space-y-4 pb-20">
                <!-- éª¨æ¶å±è¼‰å…¥ä¸­ -->
                <div class="py-20 text-center text-slate-300 italic animate-pulse">æ­£åœ¨å¾é›²ç«¯åŒæ­¥è³‡æ–™...</div>
            </div>
        </section>
    </main>

    <!-- åº•éƒ¨é€šçŸ¥æç¤º -->
    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[10px] px-6 py-3 rounded-full opacity-0 pointer-events-none transition-opacity duration-300 z-50 shadow-2xl"></div>

    <script>
        /**
         * 1. é…ç½®å€
         * è«‹åœ¨æ­¤è™•å¡«å…¥æ‚¨ Google Sheetsã€Œç™¼ä½ˆåˆ°ç¶²è·¯ã€ç”¢ç”Ÿçš„ CSV é€£çµ
         */
        const config = {
            csvUrl: "https://docs.google.com/spreadsheets/d/1ur6DxhLHX_hmOhBdx37eJSExtegrQ-T15uGBxzuMPKc/edit?usp=sharing&ouid=111111111111111111111&rtpof=true&sd=true"
        };

        /**
         * å‚™ä»½è³‡æ–™ (ç•¶ç¶²è·¯è«‹æ±‚å¤±æ•—æ™‚ä½¿ç”¨)
         */
        const backupData = [
            { district: "é¹½åŸ•å€", name: "æ¼«éŠæ„›æ²³", category: "æˆ¶å¤–/ä¼‘é–’", type: "æ‰‹æ–é£²", brand: "50åµ", detail: "é»ƒé‡‘çƒé¾æ‹¿éµ" },
            { district: "é¹½åŸ•å€", name: "é§äºŒå¤§åº«çœ‹å°ˆå ´", category: "éŸ³æ¼”/å±•è¦½", type: "æ‰‹æ–é£²", brand: "è¿·å®¢å¤", detail: "å¤§æ­£ç´…èŒ¶æ‹¿éµ" },
            { district: "é¹½åŸ•å€", name: "è¥¿å­ç£çœ‹æµ·", category: "æˆ¶å¤–/å¤•é™½", type: "æ‰‹æ–é£²", brand: "æ¸…å¿ƒç¦å…¨", detail: "çƒé¾ç¶ èŒ¶" },
            { district: "é¹½åŸ•å€", name: "æ——æ´¥è¸æµª", category: "æˆ¶å¤–/æµ·æ¿±", type: "æ‰‹æ–é£²", brand: "CoCo éƒ½å¯", detail: "ç™¾é¦™é›™éŸ¿ç‚®" },
            { district: "é¹½åŸ•å€", name: "Do good coffee & dessert", category: "å’–å•¡å»³", type: "æ‰‹æ–é£²", brand: "å†ç¡5åˆ†é˜", detail: "æ£‰è¢«åˆèŒ‰ç¶ " },
            { district: "é¹½åŸ•å€", name: "ç¥è«­å’–å•¡ é§äºŒåº—", category: "å’–å•¡å»³", type: "æ‰‹æ–é£²", brand: "å¯ä¸å¯ç†Ÿæˆç´…èŒ¶", detail: "ç™½ç‰æ­è•¾" },
            { district: "é¼“å±±å€", name: "æµ·é¢¨å»£å ´è½éŸ³æ¨‚", category: "æˆ¶å¤–/éŸ³æ¨‚", type: "æ‰‹æ–é£²", brand: "é¶´èŒ¶æ¨“", detail: "æ³°å¼å¥¶èŒ¶" },
            { district: "é¼“å±±å€", name: "é«˜ç¾é¤¨çœ‹å±•è¦½", category: "è—è¡“/æ–‡åŒ–", type: "æ‰‹æ–é£²", brand: "éº»å¤èŒ¶åŠ", detail: "ç¿¡ç¿ æŸ³æ©™" },
            { district: "é¼“å±±å€", name: "é‡‘é¦¬å’–å•¡å»³", category: "å’–å•¡å»³", type: "æ‰‹æ–é£²", brand: "å¾—æ­£", detail: "çƒé¾é®®å¥¶" },
            { district: "ä¸‰æ°‘å€", name: "å’Œå¥½çˆå•¡åº—", category: "å’–å•¡å»³", type: "é»å¿ƒ", brand: "èƒ–å°¼å’–å•¡", detail: "å¯é Œ (ç¬¬ä¸€å)" },
            { district: "ä¸‰æ°‘å€", name: "äºŒæœ¨å’–å•¡", category: "å’–å•¡å»³", type: "é»å¿ƒ", brand: "harmone", detail: "æ³•å¼åå¸" },
            { district: "æ–°èˆˆå€", name: "äºŒæœ¨å’–å•¡Â·å¤œé–“éƒ¨", category: "å’–å•¡å»³", type: "é»å¿ƒ", brand: "é¹¿èŠ", detail: "æª¸æª¬å¡”" }
        ];

        /**
         * 2. æ°›åœèˆ‡å­é¡åˆ¥é‚è¼¯
         */
        const subOptions = {
            'åœ°é»': [
                { name: 'å…¨éƒ¨', key: 'å…¨éƒ¨', tags: [] },
                { name: 'æµªæ¼«æ°£æ°› ğŸ’•', key: 'æµªæ¼«', tags: ['å¤•é™½', 'æµ·æ¿±', 'çœ‹æµ·', 'å¤œæ™¯', 'æ²³ç•”', 'æµªæ¼«'] },
                { name: 'ç†±é¬§å¥½ç© ğŸ”¥', key: 'ç†±é¬§', tags: ['éŸ³æ¨‚', 'éŸ³æ¼”', 'å±•è¦½', 'æ´»å‹•', 'ç†±é¬§'] },
                { name: 'å®‰éœæ–‡é’ ğŸ“–', key: 'å®‰éœ', tags: ['å’–å•¡å»³', 'æ–‡åŒ–', 'è—è¡“', 'åœ–æ›¸', 'å®‰éœ'] },
                { name: 'æ´»æ½‘æˆ¶å¤– ğŸƒ', key: 'æ´»æ½‘', tags: ['æˆ¶å¤–', 'é‹å‹•', 'å…¬åœ’', 'ä¼‘é–’', 'æ´»æ½‘'] }
            ],
            'é©šå–œ': [
                { name: 'å…¨éƒ¨', key: 'å…¨éƒ¨', tags: [] },
                { name: 'æ‰‹æ–é£² ğŸ¥¤', key: 'é£²', tags: ['æ‰‹æ–é£²', 'é£²æ–™'] },
                { name: 'ç”œé»é»å¿ƒ ğŸ¥¯', key: 'é»', tags: ['é»å¿ƒ', 'ç”œé»', 'è›‹ç³•', 'å¯é Œ'] }
            ]
        };

        let allData = [];
        let filterMain = 'å…¨éƒ¨';
        let filterSub = 'å…¨éƒ¨';

        /**
         * 3. è³‡æ–™æŠ“å–èˆ‡è§£æ
         */
        async function fetchData() {
            const list = document.getElementById('dataList');
            try {
                // å˜—è©¦å¾é›²ç«¯ç²å–
                const response = await fetch(config.csvUrl);
                if (!response.ok) throw new Error("Google è«‹æ±‚æœªæˆåŠŸ");
                
                const csvText = await response.text();
                if (csvText.includes("<!DOCTYPE html>")) throw new Error("é€£çµæ ¼å¼éŒ¯èª¤ (é CSV)");

                const rows = csvText.split(/\r?\n/).filter(line => line.trim() !== "");
                
                allData = rows.slice(1).map(row => {
                    const cols = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];
                    return {
                        district: (cols[0] || "").replace(/"/g, ''),
                        name: (cols[1] || "").replace(/"/g, ''),
                        category: (cols[2] || "").replace(/"/g, ''),
                        type: (cols[3] || "").replace(/"/g, ''),
                        brand: (cols[4] || "").replace(/"/g, ''),
                        detail: (cols[5] || "").replace(/"/g, '')
                    };
                });

                showToast(`åŒæ­¥æˆåŠŸï¼å…± ${allData.length} ç­†è³‡æ–™`);
            } catch (err) {
                console.warn("ç„¡æ³•å–å¾—é›²ç«¯è³‡æ–™ï¼Œæ”¹ç”¨å…§å»ºå‚™ä»½è³‡æ–™ã€‚", err);
                allData = backupData; // ä½¿ç”¨å‚™ä»½è³‡æ–™
                showToast("ä½¿ç”¨å…§å»ºè³‡æ–™æ¨¡å¼ (é›¢ç·š)");
            } finally {
                renderData();
            }
        }

        /**
         * 4. æ¸²æŸ“é‚è¼¯
         */
        function setMainFilter(type) {
            filterMain = type;
            filterSub = 'å…¨éƒ¨';
            
            ['å…¨éƒ¨', 'åœ°é»', 'é©šå–œ'].forEach(id => {
                const btn = document.getElementById(`btn-${id}`).firstElementChild;
                if (id === type) {
                    btn.classList.add('bg-blue-600', 'text-white', 'border-blue-600', 'shadow-blue-100', 'shadow-lg');
                } else {
                    btn.classList.remove('bg-blue-600', 'text-white', 'border-blue-600', 'shadow-blue-100', 'shadow-lg');
                }
            });

            renderSubMenu();
            renderData();
        }

        function renderSubMenu() {
            const menu = document.getElementById('subMenu');
            const list = document.getElementById('subMenuList');
            
            if (filterMain === 'å…¨éƒ¨') {
                menu.classList.add('hidden');
                return;
            }

            menu.classList.remove('hidden');
            list.innerHTML = '';

            subOptions[filterMain].forEach(opt => {
                const btn = document.createElement('button');
                btn.className = `flex-shrink-0 px-5 py-2.5 rounded-2xl text-xs font-bold border border-slate-200 transition-all shadow-sm ${filterSub === opt.key ? 'active-sub-btn' : 'bg-white text-slate-500'}`;
                btn.innerText = opt.name;
                btn.onclick = () => {
                    filterSub = opt.key;
                    renderSubMenu();
                    renderData();
                };
                list.appendChild(btn);
            });
        }

        function renderData() {
            const list = document.getElementById('dataList');
            const label = document.getElementById('listLabel');
            
            let results = allData.filter(item => {
                const isSurprise = item.type.includes('é£²') || item.type.includes('é»');
                if (filterMain === 'åœ°é»') return !isSurprise;
                if (filterMain === 'é©šå–œ') return isSurprise;
                return true;
            });

            if (filterSub !== 'å…¨éƒ¨') {
                const currentOpt = subOptions[filterMain].find(o => o.key === filterSub);
                results = results.filter(item => {
                    const content = (item.category + item.type + item.name + item.detail).toLowerCase();
                    return currentOpt.tags.some(tag => content.includes(tag.toLowerCase()));
                });
            }

            label.innerText = filterSub === 'å…¨éƒ¨' ? `${filterMain}æ¸…å–®` : `${filterSub}é¢¨æ ¼`;
            document.getElementById('counter').innerText = `${results.length} ITEMS`;
            
            list.innerHTML = results.length === 0 ? 
                '<div class="py-20 text-center text-slate-300 text-sm">æ­¤åˆ†é¡ä¸‹å°šç„¡ç¬¦åˆè³‡æ–™</div>' : '';

            results.forEach(item => {
                const isDrink = item.type.includes('é£²');
                const card = document.createElement('div');
                card.className = "bg-white p-6 rounded-[2.5rem] border border-slate-100 shadow-sm space-y-4 animate-fade transition-transform active:scale-[0.98]";
                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="space-y-1.5">
                            <div class="flex gap-2">
                                <span class="bg-slate-900 text-white text-[9px] font-black px-2 py-0.5 rounded-full uppercase tracking-tighter">${item.district}</span>
                                <span class="bg-slate-100 text-slate-400 text-[9px] font-bold px-2 py-0.5 rounded-full uppercase tracking-tighter">${item.category}</span>
                            </div>
                            <h3 class="text-xl font-bold text-slate-800 tracking-tight">${item.name}</h3>
                        </div>
                        <div class="text-3xl filter grayscale-[0.2]">${isDrink ? 'ğŸ¥¤' : 'ğŸ¥¯'}</div>
                    </div>
                    
                    <div class="bg-slate-50 p-4 rounded-3xl border border-slate-100/50 flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-[9px] text-slate-400 font-black uppercase tracking-widest mb-0.5">${item.brand}</p>
                            <p class="text-xs font-bold text-slate-700">${item.detail}</p>
                        </div>
                        <div class="flex flex-col items-end">
                            <span class="text-[9px] font-black text-blue-500 bg-blue-50 px-2 py-1 rounded-lg">${item.type}</span>
                        </div>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function showToast(msg) {
            const el = document.getElementById('toast');
            el.innerText = msg;
            el.classList.replace('opacity-0', 'opacity-100');
            setTimeout(() => el.classList.replace('opacity-100', 'opacity-0'), 2500);
        }

        window.onload = fetchData;
    </script>
</body>
</html>