<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KH Explore - æ°›åœéæ¿¾</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-10">

    <header class="bg-white/90 backdrop-blur-md sticky top-0 z-40 border-b border-slate-100 px-6 py-4">
        <div class="flex justify-between items-center max-w-md mx-auto">
            <div>
                <h1 class="text-xl font-black text-slate-800 tracking-tight">KH EXPLORE</h1>
                <p class="text-[9px] text-blue-500 font-bold uppercase tracking-widest">Shared Moments</p>
            </div>
            <button onclick="fetchData()" class="p-2 bg-slate-100 rounded-full active:rotate-180 transition-all duration-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </button>
        </div>
    </header>

    <main class="max-w-md mx-auto p-5 space-y-6">
        
        <section class="grid grid-cols-4 gap-3">
            <button id="btn-å…¨éƒ¨" onclick="setMainFilter('å…¨éƒ¨')" class="flex flex-col items-center gap-2 group">
                <div class="w-14 h-14 bg-white shadow-sm rounded-2xl flex items-center justify-center text-xl border border-slate-100 transition-all group-active:scale-95">ğŸ </div>
                <span class="text-[10px] font-bold text-slate-400">å…¨éƒ¨</span>
            </button>
            <button id="btn-åœ°é»" onclick="setMainFilter('åœ°é»')" class="flex flex-col items-center gap-2 group">
                <div class="w-14 h-14 bg-white shadow-sm rounded-2xl flex items-center justify-center text-xl border border-slate-100 transition-all group-active:scale-95">ğŸ“</div>
                <span class="text-[10px] font-bold text-slate-400">åœ°é»</span>
            </button>
            <button id="btn-é©šå–œ" onclick="setMainFilter('é©šå–œ')" class="flex flex-col items-center gap-2 group">
                <div class="w-14 h-14 bg-white shadow-sm rounded-2xl flex items-center justify-center text-xl border border-slate-100 transition-all group-active:scale-95">ğŸ</div>
                <span class="text-[10px] font-bold text-slate-400">é©šå–œ</span>
            </button>
            <button onclick="window.open('æ‚¨çš„Googleè¡¨å–®é€£çµ')" class="flex flex-col items-center gap-2 group">
                <div class="w-14 h-14 bg-emerald-500 shadow-lg shadow-emerald-100 rounded-2xl flex items-center justify-center text-xl text-white transition-all group-active:scale-95">â•</div>
                <span class="text-[10px] font-bold text-slate-400">æ–°å¢</span>
            </button>
        </section>

        <section id="subMenu" class="hidden animate-fade">
            <p class="text-[10px] font-black text-slate-400 mb-3 ml-1 uppercase tracking-widest">é¸æ“‡é¢¨æ ¼</p>
            <div id="subMenuList" class="flex gap-2 overflow-x-auto hide-scrollbar pb-1">
                </div>
        </section>

        <section class="space-y-4">
            <div class="flex items-center justify-between px-1">
                <h2 id="listLabel" class="text-sm font-bold text-slate-500 uppercase tracking-tighter">æ¸…å–®</h2>
                <span id="counter" class="text-[9px] bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full font-black">0 ITEMS</span>
            </div>
            <div id="dataList" class="space-y-4 pb-20">
                <div class="py-20 text-center text-slate-300 italic animate-pulse">æ­£åœ¨å¾é›²ç«¯åŒæ­¥è³‡æ–™...</div>
            </div>
        </section>
    </main>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[10px] px-6 py-3 rounded-full opacity-0 pointer-events-none transition-opacity duration-300 z-50 shadow-2xl"></div>

    <script>
        const config = {
            // è«‹ç¢ºèªæ‚¨çš„ CSV é€£çµæ­£ç¢º
            csvUrl: "https://docs.google.com/spreadsheets/d/1ur6DxhLHX_hmOhBdx37eJSExtegrQ-T15uGBxzuMPKc/export?format=csv"
        };

        const backupData = [
            { district: "ç¯„ä¾‹", name: "ç„¡è³‡æ–™", category: "", type: "", brand: "", detail: "è«‹æª¢æŸ¥é€£çµ" }
        ];

        /**
         * å®šç¾©é—œéµå­—æ˜ å°„
         * é€™è£¡çš„ tags æœƒå»æ¯”å°æ‚¨ Excel è£¡çš„å…§å®¹
         */
        const subOptions = {
            'åœ°é»': [
                { name: 'å…¨éƒ¨', key: 'å…¨éƒ¨', tags: [] },
                // æµªæ¼«: å¤•é™½, æµ·æ¿±, æ¼æ¸¯, å¤œæ™¯
                { name: 'æµªæ¼«æ°£æ°› ğŸ’•', key: 'æµªæ¼«', tags: ['å¤•é™½', 'æµ·æ¿±', 'æ¼æ¸¯', 'å¤œæ™¯', 'æµ·'] },
                // ç†±é¬§: éŸ³æ¼”, å±•è¦½, éŸ³æ¨‚, å¸‚é›†, å¨›æ¨‚
                { name: 'ç†±é¬§å¥½ç© ğŸ”¥', key: 'ç†±é¬§', tags: ['éŸ³æ¼”', 'å±•è¦½', 'éŸ³æ¨‚', 'å¸‚é›†', 'å¨›æ¨‚', 'ç†±é¬§'] },
                // å®‰éœ: å’–å•¡å»³, è—è¡“, æ–‡åŒ–, æ­·å²
                { name: 'å®‰éœæ–‡é’ ğŸ“–', key: 'å®‰éœ', tags: ['å’–å•¡å»³', 'è—è¡“', 'æ–‡åŒ–', 'æ­·å²', 'å®‰éœ'] },
                // æ´»æ½‘: ä¼‘é–’, é‹å‹•, éœ²ç‡Ÿ (é€™è£¡åŒ…å«äº†æ‚¨ Excel çš„ "å¸‚é›†å…¬åœ’", "é‹å‹•å®¤å…§", "éœ²ç‡Ÿ")
                { name: 'æ´»æ½‘æˆ¶å¤– ğŸƒ', key: 'æ´»æ½‘', tags: ['ä¼‘é–’', 'é‹å‹•', 'éœ²ç‡Ÿ', 'å…¬åœ’', 'æ´»æ½‘'] }
            ],
            'é©šå–œ': [
                { name: 'å…¨éƒ¨', key: 'å…¨éƒ¨', tags: [] },
                { name: 'æ‰‹æ–é£² ğŸ¥¤', key: 'é£²', tags: ['é£²', 'èŒ¶', 'å’–å•¡', 'æœæ±'] },
                { name: 'ç”œé»é»å¿ƒ ğŸ¥¯', key: 'é»', tags: ['é»', 'è›‹ç³•', 'éºµåŒ…', 'å°åƒ', 'é£Ÿ'] }
            ]
        };

        let allData = [];
        let filterMain = 'å…¨éƒ¨';
        let filterSub = 'å…¨éƒ¨';

        function fetchData() {
            Papa.parse(config.csvUrl, {
                download: true,
                header: false,
                complete: function(results) {
                    // åš´æ ¼å°æ‡‰æ¬„ä½ç´¢å¼•
                    // [0]District, [1]Name, [2]Category, [3]Type, [4]Brand, [5]Detail
                    allData = results.data.slice(1).map(cols => {
                        if (!cols[0]) return null;
                        return {
                            district: cols[0] || "",
                            name: cols[1] || "",
                            category: cols[2] || "",
                            type: cols[3] || "",
                            brand: cols[4] || "",
                            detail: cols[5] || ""
                        };
                    }).filter(item => item !== null);

                    showToast(`åŒæ­¥æˆåŠŸï¼å…± ${allData.length} ç­†è³‡æ–™`);
                    renderData();
                },
                error: function(err) {
                    allData = backupData;
                    renderData();
                }
            });
        }

        function setMainFilter(type) {
            filterMain = type;
            filterSub = 'å…¨éƒ¨'; // åˆ‡æ›å¤§åˆ†é¡æ™‚ï¼Œé‡ç½®å­åˆ†é¡
            
            // UI æ›´æ–°
            ['å…¨éƒ¨', 'åœ°é»', 'é©šå–œ'].forEach(id => {
                const btnContainer = document.getElementById(`btn-${id}`);
                const btn = btnContainer.firstElementChild;
                const txt = btnContainer.lastElementChild;
                
                if (id === type) {
                    btn.classList.add('bg-blue-600', 'text-white', 'border-blue-600', 'shadow-blue-100', 'shadow-lg');
                    txt.classList.add('text-blue-600');
                } else {
                    btn.classList.remove('bg-blue-600', 'text-white', 'border-blue-600', 'shadow-blue-100', 'shadow-lg');
                    txt.classList.remove('text-blue-600');
                }
            });

            renderSubMenu();
            renderData();
        }

        function renderSubMenu() {
            const menu = document.getElementById('subMenu');
            const list = document.getElementById('subMenuList');
            
            if (filterMain === 'å…¨éƒ¨') {
                menu.classList.add('hidden');
                return;
            }

            menu.classList.remove('hidden');
            list.innerHTML = '';

            if (subOptions[filterMain]) {
                subOptions[filterMain].forEach(opt => {
                    const btn = document.createElement('button');
                    const isActive = filterSub === opt.key;
                    btn.className = `flex-shrink-0 px-4 py-2 rounded-xl text-xs font-bold border transition-all shadow-sm whitespace-nowrap ${
                        isActive ? 'bg-slate-800 text-white border-slate-800' : 'bg-white text-slate-500 border-slate-200'
                    }`;
                    btn.innerText = opt.name;
                    btn.onclick = () => { filterSub = opt.key; renderSubMenu(); renderData(); };
                    list.appendChild(btn);
                });
            }
        }

        function renderData() {
            const list = document.getElementById('dataList');
            const label = document.getElementById('listLabel');
            
            // --- æ­¥é©Ÿ 1: åš´æ ¼éæ¿¾è³‡æ–™ ---
            let results = allData.filter(item => {
                
                // æƒ…æ³ A: åœ°é»æ¨¡å¼
                // è¦å‰‡: å¿…é ˆæœ‰ category è³‡æ–™ã€‚å¿½ç•¥ type, brand, detailã€‚
                if (filterMain === 'åœ°é»') {
                    if (!item.category) return false; // æ²’å¡«å‡ºéŠé¡å‹å°±ä¸é¡¯ç¤º
                    
                    // æª¢æŸ¥å­åˆ†é¡ (é¢¨æ ¼)
                    if (filterSub !== 'å…¨éƒ¨') {
                        const currentOpt = subOptions['åœ°é»'].find(o => o.key === filterSub);
                        // æ¯”å° category æ¬„ä½æ˜¯å¦åŒ…å«é—œéµå­—
                        return currentOpt.tags.some(tag => item.category.includes(tag));
                    }
                    return true;
                }

                // æƒ…æ³ B: é©šå–œæ¨¡å¼
                // è¦å‰‡: å¿…é ˆæœ‰ type è³‡æ–™ã€‚å¿½ç•¥ categoryã€‚
                if (filterMain === 'é©šå–œ') {
                    if (!item.type) return false; // æ²’å¡«é©šå–œé¡å‹å°±ä¸é¡¯ç¤º
                    
                    // æª¢æŸ¥å­åˆ†é¡
                    if (filterSub !== 'å…¨éƒ¨') {
                        const currentOpt = subOptions['é©šå–œ'].find(o => o.key === filterSub);
                        // æ¯”å° type æ¬„ä½æ˜¯å¦åŒ…å«é—œéµå­—
                        return currentOpt.tags.some(tag => item.type.includes(tag));
                    }
                    return true;
                }

                // æƒ…æ³ C: å…¨éƒ¨æ¨¡å¼ (é¡¯ç¤ºæ‰€æœ‰è³‡æ–™ï¼Œä½†ä¾ç…§æ˜¯å¦æœ‰å€¼ä¾†åˆ¤æ–·)
                return true;
            });

            // æ›´æ–°è¨ˆæ•¸
            label.innerText = filterSub === 'å…¨éƒ¨' ? `${filterMain}æ¸…å–®` : `${filterSub}é¢¨æ ¼`;
            document.getElementById('counter').innerText = `${results.length} ITEMS`;
            
            list.innerHTML = results.length === 0 ? 
                '<div class="py-20 text-center text-slate-300 text-sm">æ­¤åˆ†é¡ä¸‹å°šç„¡è³‡æ–™</div>' : '';

            // --- æ­¥é©Ÿ 2: åš´æ ¼æ¸²æŸ“å¡ç‰‡ (è¦–è¦ºéš”é›¢) ---
            results.forEach(item => {
                const card = document.createElement('div');
                card.className = "bg-white p-5 rounded-[2rem] border border-slate-100 shadow-sm space-y-3 animate-fade transition-transform active:scale-[0.98]";

                let cardContent = '';

                // === æ¸²æŸ“æ¨¡å¼ï¼šåœ°é» ===
                // åªé¡¯ç¤º: å€åŸŸ, åç¨±, å‡ºéŠé¡å‹ (Category)
                // çµ•å°ä¸é¡¯ç¤º: Type, Brand, Detail
                if (filterMain === 'åœ°é»') {
                    cardContent = `
                        <div class="flex justify-between items-start">
                            <div class="space-y-1">
                                <div class="flex flex-wrap gap-1.5">
                                    <span class="bg-slate-800 text-white text-[9px] font-black px-2 py-0.5 rounded-md uppercase tracking-wider">${item.district}</span>
                                </div>
                                <h3 class="text-lg font-black text-slate-800 tracking-tight leading-tight">${item.name}</h3>
                            </div>
                            <div class="text-xs font-bold text-blue-500 bg-blue-50 px-2 py-1 rounded-lg">
                                ${item.category}
                            </div>
                        </div>
                    `;
                }
                
                // === æ¸²æŸ“æ¨¡å¼ï¼šé©šå–œ ===
                // åªé¡¯ç¤º: é©šå–œé¡å‹ (Type), å“ç‰Œ (Brand), ç´°é … (Detail)
                // çµ•å°ä¸é¡¯ç¤º: Category
                else if (filterMain === 'é©šå–œ') {
                    const isDrink = item.type.includes('é£²') || item.type.includes('èŒ¶');
                    cardContent = `
                        <div class="flex justify-between items-start">
                            <div class="space-y-1">
                                <span class="bg-slate-100 text-slate-500 text-[9px] font-bold px-2 py-0.5 rounded-md uppercase tracking-wider">é©šå–œ</span>
                                <h3 class="text-lg font-black text-slate-800 tracking-tight leading-tight">${item.name}</h3> </div>
                            <div class="text-2xl filter grayscale-[0.3] opacity-80">${isDrink ? 'ğŸ¥¤' : 'ğŸ'}</div>
                        </div>
                        <div class="bg-slate-50 p-3.5 rounded-2xl border border-slate-100 flex items-center justify-between gap-3">
                            <div class="min-w-0">
                                <p class="text-[9px] text-slate-400 font-black uppercase tracking-widest mb-0.5 truncate">${item.brand}</p>
                                <p class="text-xs font-bold text-slate-600 truncate">${item.detail}</p>
                            </div>
                            <div class="flex-shrink-0">
                                <span class="text-[9px] font-bold text-slate-500 bg-white border border-slate-200 px-2 py-1 rounded-lg">${item.type}</span>
                            </div>
                        </div>
                    `;
                }

                // === æ¸²æŸ“æ¨¡å¼ï¼šå…¨éƒ¨ ===
                // æ··åˆé¡¯ç¤ºï¼Œæˆ–è€…æ ¹æ“šè³‡æ–™æœ‰ç„¡ä¾†åˆ¤æ–·
                else {
                    const isDrink = item.type && (item.type.includes('é£²') || item.type.includes('èŒ¶'));
                    cardContent = `
                        <div class="flex justify-between items-start">
                            <div class="space-y-1">
                                <div class="flex flex-wrap gap-1.5">
                                    <span class="bg-slate-800 text-white text-[9px] font-black px-2 py-0.5 rounded-md uppercase tracking-wider">${item.district}</span>
                                    ${item.category ? `<span class="bg-blue-50 text-blue-600 text-[9px] font-bold px-2 py-0.5 rounded-md tracking-wider border border-blue-100">${item.category}</span>` : ''}
                                </div>
                                <h3 class="text-lg font-black text-slate-800 tracking-tight leading-tight">${item.name}</h3>
                            </div>
                             ${item.type ? `<div class="text-2xl filter grayscale-[0.3] opacity-80">${isDrink ? 'ğŸ¥¤' : 'ğŸ'}</div>` : ''}
                        </div>
                        
                        ${item.type ? `
                        <div class="bg-slate-50 p-3.5 rounded-2xl border border-slate-100 flex items-center justify-between gap-3 mt-3">
                            <div class="min-w-0">
                                <p class="text-[9px] text-slate-400 font-black uppercase tracking-widest mb-0.5 truncate">${item.brand}</p>
                                <p class="text-xs font-bold text-slate-600 truncate">${item.detail}</p>
                            </div>
                             <div class="flex-shrink-0">
                                <span class="text-[9px] font-bold text-slate-500 bg-white border border-slate-200 px-2 py-1 rounded-lg">${item.type}</span>
                            </div>
                        </div>` : ''}
                    `;
                }

                card.innerHTML = cardContent;
                list.appendChild(card);
            });
        }

        function showToast(msg) {
            const el = document.getElementById('toast');
            el.innerText = msg;
            el.classList.replace('opacity-0', 'opacity-100');
            setTimeout(() => el.classList.replace('opacity-100', 'opacity-0'), 2500);
        }

        window.onload = fetchData;
    </script>
</body>
</html>